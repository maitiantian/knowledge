# 服务器端渲染和浏览器端渲染

## 渲染

如果只是想显示一堆不变的数据，那么直接写一个a.html丢到服务器上让客户端访问就可以了。但这是基本不可能的事情，数据一般是变化的。不可能为每套数据写一个视图，所以需要分离数据和视图，然后使用一种技术将数据塞到视图中，这种技术就叫渲染。

这工作放在服务器上做就是服务器端渲染，放在浏览器（客户端）上做就是浏览器端渲染。

***这里的渲染，是指生成html文档的过程。***

浏览器端渲染，指的是用js去生成html，前端做路由。
> 举例：React，Vue等等前端框架。适合单页面应用程序。

服务器端渲染，指的是用后台语言通过一些模版引擎生成html。
> 举例：PHP文件、JSP文件、Python的Flask配合Jinja引擎、Django框架、Java配合vm模版引擎、NodeJS配合Jade。适合多页面应用。现在大部分网站还是这种形式。

**服务器端渲染，Server-Side Rendering，SSR**

![SSR示意图](../../images/ssr.jpg)

**浏览器端渲染，Client-Side Rendering，CSR**

![CSR示意图](../../images/csr.jpg)

浏览器端渲染路线：
1. 浏览器请求一个html；
2. 服务器返回一个html；
3. 浏览器下载html中的js/css文件；
4. 等待js文件下载完成；
5. 等待js加载并初始化完成；
6. js代码运行，由js代码向后端请求数据（ajax/fetch）；
7. 等待后端数据返回；
8. 客户端从无到有的渲染出页面。

服务器端渲染路线：
1. 浏览器请求一个html；
2. 服务器端请求数据（内网请求快）；
3. 服务器初始渲染（服务器性能好，较快）；
4. 服务器端返回已经有正确内容的页面；
5. 客户端请求js/css文件；
6. 等待js文件下载完成；
7. 等待js加载并初始化完成；
8. 客户端把剩下一部分渲染完成（内容小，渲染快）。

对同一个组件，服务器端渲染“可视的”一部分（render/componentWillMount部分代码），为确保组件有完善的生命周期及事件处理，客户端需要再次渲染。即：服务器端渲染，实际上也是需要浏览器端进行再次地、但开销很小的二次渲染。

在用户体验要求比较高的页面（首屏）、重复较多的公共页面可以考虑使用服务器端渲染，减少ajax请求和提升用户体验。

时间耗时比较：

* 数据请求：服务器在内网进行数据请求，数据响应速度快。浏览器端在不同网络环境下进行数据请求，且外网http请求开销大，导致时间消耗大（主要原因）；
* 步骤：服务器端是先请求数据然后渲染，而浏览器端是等待js代码下载、加载完成再请求数据、渲染；
* 渲染性能：服务器端性能比浏览器端高，渲染速度快（猜测，该项数据不详）；
* 渲染内容：服务器端渲染会把“可视”部分先渲染，然后交给浏览器端再作部分渲染。而浏览器端渲染，则是从无到有，需要经历完整的渲染步骤。

